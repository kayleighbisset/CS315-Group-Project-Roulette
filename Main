import random

# Node for the circular linked list
class Node:
    def __init__(self, data=None):
        # Data stored in the node (roulette pocket)
        self.data = data
        # Reference to the next node
        self.next = None

# Roulette wheel using a circular linked list
class Wheel:
    def __init__(self, seed=None):
        # Create a random number generator
        self.rng = random.Random(seed)
        # Store the pockets as nodes in a circular linked list: 0 and 00 (stored as -1), then 1–36
        values = [0, -1] + list(range(1, 37))
        self.head = None       # head pointer of the circular linked list
        self.size = 0          # number of nodes in the list
        self.index = 0         

        tail = None  # will track the last node so we can link in (O(1))

        # Build the circular linked list (O(n)) everything inside is O(1)
        for v in values:
            new_node = Node(v)
            if self.head is None:
                # First node: points to itself for now 
                self.head = new_node
                new_node.next = new_node
                tail = new_node
            else:
                
                tail.next = new_node
                new_node.next = self.head
                tail = new_node
            self.size += 1

        # current will act like our pointer moving around the wheel
        self.current = self.head

    def spin(self):
        # Generate a random number of steps to "move" forward on the wheel, traversal of the circular linked list
        steps = self.rng.randint(0, self.size * 5)

        # Move current pointer forward by 'steps' nodes
        for i in range(steps):
            self.current = self.current.next

        # Return the number it landed on
        return self.current.data

# Converts -1 back to the string "00" for printing (O(1))
def fmt_pocket(v):
    return "00" if v == -1 else str(v)

#Sets for colors: o(1)
RED = {1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36}
BLACK = set(range(1, 37)) - RED

# Returns string color name for a given number
def get_color(num):
    if num in RED:
        return "RED"
    elif num in BLACK:
        return "BLACK"
    else:
        # Only 0 or 00 reach here, both are GREEN
        return "GREEN"

def main():
    print("Welcome to Roulette!")

    # Ask user how much money to start with
    # loop until they enter a valid positive integer
    while True:
        money_input = input("How much money do you want to start with? $")
        try:
            money = int(money_input)
            if money <= 0:
                print("Invalid input. Starting money must be a positive integer.")
                continue
            break
        except ValueError:
            print("Invalid input. Please enter a whole dollar amount (integer).")

    wheel = Wheel()
    round_num = 1

    # Game runs as long as player has money
    while money > 0:
        print(f"You currently have ${money}.")
        print(f"***Round {round_num}***\n")

        # Bet amount input, must be an integer > 0 and not more than current money
        while True:
            bet_input = input("How much would you like to bet? $")
            try:
                bet_amnt = int(bet_input)
            except ValueError:
                print("Invalid input. Please enter an integer bet amount.")
                print(f"Current money value: ${money}.")
                continue

            if bet_amnt > money:
                print(f"Invalid input. Bet amount cannot be greater than your current money value: ${money}. Please try again.\n")
                continue
            elif bet_amnt <= 0:
                print("Invalid input. Bet amount must be greater than 0. Please input again.")
                continue
            break

        # Ask which type of roulette bet they want to place
        validBetChoice = False
        while not validBetChoice:
            print("What kind of bet would you like to make?\n")
            print("1 = Straight (Single Number)")
            print("2 = Even/Odd")
            print("3 = High/Low (1-18 or 19-36)")
            print("4 = Red/Black")
            print("5 = Split")
            print("Enter your bet choice (1-5): ")

            bet_choice_input = input().strip()
            try:
                bet_choice = int(bet_choice_input)
            except ValueError:
                print("\nInvalid input. Please enter a number 1 through 5.\n")
                continue

            if 1 <= bet_choice <= 5:
                validBetChoice = True
            else:
                print("\nInvalid input. Please enter a number 1 through 5.\n")

        betType = ""

        # Straight Bet
        if bet_choice == 1:
            print("You chose bet #1\n")
            validStraight = False

            # Must choose a single number: -1 for 00 or 0–36 allowed
            while not validStraight:
                straight_input = input("Choose a number 0-36, or -1 (for 00): ").strip()
                try:
                    straightChoice = int(straight_input)
                except ValueError:
                    print("Invalid input. Please enter an integer, -1 for 00, or 0-36:")
                    continue

                if straightChoice == -1 or (0 <= straightChoice <= 36):
                    validStraight = True
                    betType = "Straight Bet"
                    print(f"You placed a straight bet on: {straightChoice}")
                else:
                    print("Invalid input. Please reenter an integer, -1 for 00, or 0-36:")

            # Spin the wheel
            result = wheel.spin()
            print(f"Wheel landed on {fmt_pocket(result)} ({get_color(result)})")

            # Straight bet pays 35:1
            if result == straightChoice:
                money += bet_amnt * 35
                print("You WIN!")
            else:
                money -= bet_amnt
                print("You lost.")
                
        # Even/Odd Bet
        elif bet_choice == 2:
            validEvenOdd = False
            while not validEvenOdd:
                even_Odd_Choice = input("Choose even or odd for your bet (E/O): ").upper().strip()
                if even_Odd_Choice == 'E':
                    validEvenOdd = True
                    betType = "Even Bet"
                    print("You have placed a bet on all EVEN numbers.")
                elif even_Odd_Choice == 'O':
                    validEvenOdd = True
                    betType = "Odd Bet"
                    print("You have placed a bet on all ODD numbers.")
                else:
                    print("Invalid Input. Please enter 'E' for even and 'O' for odd bets:")

            result = wheel.spin()
            print(f"Wheel landed on {fmt_pocket(result)} ({get_color(result)})")

            # 0 and 00 make you automatically lose
            if result in (0, -1):
                money -= bet_amnt
                print("0/00 – House wins.")
            else:
                # Check if result matches even or odd preference
                if (even_Odd_Choice == "E" and result % 2 == 0) or \
                   (even_Odd_Choice == "O" and result % 2 == 1):
                    money += bet_amnt * 1  # You win equal to what you bet
                    print("You WIN!")
                else:
                    money -= bet_amnt
                    print("You lost.")

        # High/Low Bet
        elif bet_choice == 3:
            validHighLow = False
            while not validHighLow:
                high_low = input("Choose High (19-36) or Low (1-18) bet, (H/L): ").upper().strip()
                if high_low == 'H':
                    validHighLow = True
                    betType = "High Bet"
                    print("You have placed a bet on all High numbers (19-36).")
                elif high_low == 'L':
                    validHighLow = True
                    betType = "Low Bet"
                    print("You have placed a bet on all Low numbers (1-18).")
                else:
                    print("Invalid input. Please enter 'H' or 'L': ")

            result = wheel.spin()
            print(f"Wheel landed on {fmt_pocket(result)} ({get_color(result)})")

            # 0 and 00 always lose here
            if result in (0, -1):
                money -= bet_amnt
                print("0/00 – House wins.")
            else:
                # Check if result matches high/low selection
                if (high_low == 'H' and 19 <= result <= 36) or \
                   (high_low == 'L' and 1 <= result <= 18):
                    money += bet_amnt * 1
                    print("You WIN!")
                else:
                    money -= bet_amnt
                    print("You lost.")

        # Red/Black bet
        elif bet_choice == 4:
            validColor = False
            while not validColor:
                color = input("Choose red or black (R/B): ").upper().strip()
                if color == 'R':
                    validColor = True
                    betType = "Red Bet"
                elif color == 'B':
                    validColor = True
                    betType = "Black Bet"
                else:
                    print("Invalid input. Please enter 'R' or 'B': ")

            result = wheel.spin()
            print(f"Wheel landed on {fmt_pocket(result)} ({get_color(result)})")

            # 0 and 00 lose again
            if result in (0, -1):
                money -= bet_amnt
                print("0/00 – House wins.")
            else:
                # Compare chosen color to actual landed color
                if (color == 'R' and get_color(result) == "RED") or \
                   (color == 'B' and get_color(result) == "BLACK"):
                    money += bet_amnt * 1
                    print("You WIN!")
                else:
                    money -= bet_amnt
                    print("You lost.")

        # Split bet
        elif bet_choice == 5:
            print("A split bet will choose between two numbers.\n")
            validSplit = False
            while not validSplit:
                # Ask for two integers
                first_input = input("Enter the first number (0–36): ").strip()
                second_input = input("Enter the second number (0–36): ").strip()
                try:
                    split1 = int(first_input)
                    split2 = int(second_input)
                except ValueError:
                    print("Invalid Input. Please enter integers between 0 and 36.")
                    continue

                # Cannot be same number
                if split1 == split2:
                    print("Invalid Input. The two inputs cannot be the same.")
                elif not (0 <= split1 <= 36 and 0 <= split2 <= 36):
                    print("Invalid Input. Inputs must be between 0 and 36.")
                else:
                    validSplit = True
                    print(f"You placed a split bet on: {split1} and {split2}")

            result = wheel.spin()
            print(f"Wheel landed on {fmt_pocket(result)} ({get_color(result)})")

            # Split pays 17:1 if either number hits
            if result == split1 or result == split2:
                money += bet_amnt * 17
                print("You WIN!")
            else:
                money -= bet_amnt
                print("You lost.")

        # End of round, increase round number
        round_num += 1

    # If player exits loop, they have no money left
    print(f"You currently have ${money}.\n")
    print("You ran out of money. Game over!")

main()
